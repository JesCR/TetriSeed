<!-- Generated by SpecStory -->

# Adjusting Tetris Falling Speed by Level (2025-04-02 13:51:12)

_**User**_

I Wanto to update the speed of the game. use this approach: Update the falling speed of the pieces in my Tetris game based on the player's current level, using the original NES Tetris speed table as a reference but at double speed to increase difficulty.

Use this exact table for reference (NES original speeds × 2):

Level	Frames per cell (fall speed)	Approx. Time per cell (seconds)
0	24	0.4 seconds
1	22	0.366 seconds
2	19	0.316 seconds
3	16	0.266 seconds
4	14	0.233 seconds
5	11	0.183 seconds
6	9	0.15 seconds
7	7	0.116 seconds
8	4	0.066 seconds
9	3	0.05 seconds
10-12	3	0.05 seconds
13-15	2	0.033 seconds
16-18	1	0.016 seconds
19-28	1	0.016 seconds
29+	1	0.016 seconds
Logic to implement clearly:
Determine the player's current level based on lines cleared.
Set the falling interval according to the doubled NES speed table above.
Update the falling speed immediately after each level advancement, clearly displaying the new interval. Let the on screen messages with the same content, just update the speed of the falling pieces

---

_**Assistant**_

I'll update the falling speed logic for your Tetris game based on the NES Tetris doubled speed table you provided.

---

```diff
        setLevel(prev => prev + 1);
        
-       // Calculate new speed that keeps getting faster at each level
-       // Base speed is now 800ms instead of 1000ms, and speed increases faster
+       // Calculate new speed based on NES Tetris doubled speed table
        const newLevel = level + 1;
-       // Progressive speed formula with faster increments
-       const newDropTime = Math.max(800 / (1 + (newLevel * 0.3)), 50); // Minimum 50ms to keep game playable
+       let framesPerCell;
+       
+       // Determine frames per cell based on level using the NES speed table (doubled speed)
+       if (newLevel === 0) framesPerCell = 24;
+       else if (newLevel === 1) framesPerCell = 22;
+       else if (newLevel === 2) framesPerCell = 19;
+       else if (newLevel === 3) framesPerCell = 16;
+       else if (newLevel === 4) framesPerCell = 14;
+       else if (newLevel === 5) framesPerCell = 11;
+       else if (newLevel === 6) framesPerCell = 9;
+       else if (newLevel === 7) framesPerCell = 7;
+       else if (newLevel === 8) framesPerCell = 4;
+       else if (newLevel === 9) framesPerCell = 3;
+       else if (newLevel >= 10 && newLevel <= 12) framesPerCell = 3;
+       else if (newLevel >= 13 && newLevel <= 15) framesPerCell = 2;
+       else if (newLevel >= 16) framesPerCell = 1;
+       
+       // Convert frames to milliseconds (assuming 60fps, so 1 frame = 16.67ms)
+       const newDropTime = framesPerCell * 16.67;
        setDropTime(newDropTime);
        savedDropTimeRef.current = newDropTime;
        showInterestRateMessage(level + 1);
        
-       console.log(`Level up to ${newLevel}, new speed: ${newDropTime}ms`);
+       console.log(`Level up to ${newLevel}, new speed: ${newDropTime}ms (${framesPerCell} frames)`);
      }
  
      // Reset everything
      setStage(createStage());
-     // Initial speed 20% faster than before (1000ms -> 800ms)
-     const initialDropTime = 800;
+     // Set initial drop time based on NES Tetris level 0 (24 frames * 16.67ms = 400ms)
+     const initialDropTime = 24 * 16.67; // Level 0 speed
      setDropTime(initialDropTime);
      savedDropTimeRef.current = initialDropTime;
      setScore(0);
      setRows(0);
-     setLevel(1);
+     setLevel(0); // Start at level 0 to match NES Tetris
      
      // Start playing background music
```

---

I've updated the speed calculation logic in your Tetris game to use the exact NES Tetris doubled speed table as requested. The changes include:

1. Changed the initial level to start at 0 instead of 1, matching the original NES Tetris
2. Implemented the frame-based timing system where:
   - Level 0: 24 frames (400ms)
   - Level 1: 22 frames (366ms)
   - Level 2: 19 frames (316ms)
   - And so on following your provided table

3. Converted the frames to milliseconds using a 60fps reference (1 frame = 16.67ms)
4. Updated the console logging to show both the millisecond value and frame count for debugging

The falling speed will now update automatically as the player advances levels, providing a more authentic but challenging experience based on the original NES Tetris speeds, but doubled for difficulty as you requested.

---

_**User**_

ok, is too fast, double te times in the table

---

_**Assistant**_

I'll update the game speed to be half as fast by doubling the frame times from the table.

---

```diff
        
        // Determine frames per cell based on level using the NES speed table (doubled speed)
-       if (newLevel === 0) framesPerCell = 24;
-       else if (newLevel === 1) framesPerCell = 22;
-       else if (newLevel === 2) framesPerCell = 19;
-       else if (newLevel === 3) framesPerCell = 16;
-       else if (newLevel === 4) framesPerCell = 14;
-       else if (newLevel === 5) framesPerCell = 11;
-       else if (newLevel === 6) framesPerCell = 9;
-       else if (newLevel === 7) framesPerCell = 7;
-       else if (newLevel === 8) framesPerCell = 4;
-       else if (newLevel === 9) framesPerCell = 3;
-       else if (newLevel >= 10 && newLevel <= 12) framesPerCell = 3;
-       else if (newLevel >= 13 && newLevel <= 15) framesPerCell = 2;
-       else if (newLevel >= 16) framesPerCell = 1;
+       if (newLevel === 0) framesPerCell = 48;
+       else if (newLevel === 1) framesPerCell = 44;
+       else if (newLevel === 2) framesPerCell = 38;
+       else if (newLevel === 3) framesPerCell = 32;
+       else if (newLevel === 4) framesPerCell = 28;
+       else if (newLevel === 5) framesPerCell = 22;
+       else if (newLevel === 6) framesPerCell = 18;
+       else if (newLevel === 7) framesPerCell = 14;
+       else if (newLevel === 8) framesPerCell = 8;
+       else if (newLevel === 9) framesPerCell = 6;
+       else if (newLevel >= 10 && newLevel <= 12) framesPerCell = 6;
+       else if (newLevel >= 13 && newLevel <= 15) framesPerCell = 4;
+       else if (newLevel >= 16) framesPerCell = 2;
        
        // Convert frames to milliseconds (assuming 60fps, so 1 frame = 16.67ms)
      // Reset everything
      setStage(createStage());
-     // Set initial drop time based on NES Tetris level 0 (24 frames * 16.67ms = 400ms)
-     const initialDropTime = 24 * 16.67; // Level 0 speed
+     // Set initial drop time based on twice the NES Tetris level 0 (48 frames * 16.67ms = 800ms)
+     const initialDropTime = 48 * 16.67; // Doubled from 24 frames
      setDropTime(initialDropTime);
      savedDropTimeRef.current = initialDropTime;
```

---

I've slowed down the game by doubling all the frame times in the speed table:

- Level 0: Now 48 frames (800ms) instead of 24 frames
- Level 1: Now 44 frames (733ms) instead of 22 frames
- Level 2: Now 38 frames (633ms) instead of 19 frames
- And so on for all levels

The initial speed at game start is also adjusted to match this slower pace. The game should now be half as fast as before, giving you more time to react and place the falling pieces.

---

_**User**_

in the screen after the game ends, put some space between "TWEET YOUR SCORE" and "PLAY AGAIN" buttons, now they are touching

---

_**Assistant**_

I'll add some space between those buttons in the game over screen.

---

<details>
            <summary>Grep search for "TWEET YOUR SCORE|PLAY AGAIN" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/src/components/Modal.jsx` | L160 | `Tweet Your Score` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/src/components/Modal.jsx` | L162 | `<button onClick={onClose} className="modal-button">Play Again</button>` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/.specstory/history/2025-03-27_17-37-creating-tetriseed-clear-your-debt-game.md` | L933 | `+               Tweet Your Score` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/.specstory/history/2025-03-27_17-37-creating-tetriseed-clear-your-debt-game.md` | L935 | `+             <button onClick={onClose} className="modal-button">Play Again</button>` |

</details>

---

Read file: src/components/Modal.jsx

---

```diff
                Tweet Your Score
              </a>
-             <button onClick={onClose} className="modal-button">Play Again</button>
+             <button onClick={onClose} className="modal-button" style={{ marginTop: '10px' }}>Play Again</button>
            </>
          )}
```

---

I've added spacing between the "Tweet Your Score" and "Play Again" buttons by adding a 10-pixel margin to the top of the Play Again button. This will create a visible gap between the two buttons in the end-game screen, making the UI cleaner and preventing them from touching each other.

---

_**User**_

i still see both buttons without space btween them

---

_**Assistant**_

Let me increase the spacing between the buttons by adding more margin.

---

```diff
                Tweet Your Score
              </a>
-             <button onClick={onClose} className="modal-button" style={{ marginTop: '10px' }}>Play Again</button>
+             <button onClick={onClose} className="modal-button" style={{ marginTop: '20px' }}>Play Again</button>
            </>
          )}
```

---

I've doubled the spacing between the buttons by increasing the top margin from 10px to 20px. This should create a more noticeable gap between the "Tweet Your Score" and "Play Again" buttons in the end-game screen.

---

_**User**_

are you adding marginTop, but i see them touching side by side

---

_**Assistant**_

Let me check the styles of these elements to understand why they're appearing side by side despite the margin.

---

<details>
            <summary>Searched codebase "css modal tweet" • **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

Read file: src/App.css

---

<details>
            <summary>Grep search for "\.tweet-button" • **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/src/index.css` | L526 | `.tweet-button {` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/src/index.css` | L540 | `.tweet-button:hover {` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/.specstory/history/2025-03-27_17-37-creating-tetriseed-clear-your-debt-game.md` | L1570 | `+ .tweet-button {` |
| `file:///Users/jes/MiGithub/SuperSeedSuperGame/.specstory/history/2025-03-27_17-37-creating-tetriseed-clear-your-debt-game.md` | L1583 | `+ .tweet-button:hover {` |

</details>

---

Read file: src/index.css

---

I see the issue. The problem is that the tweet button and the play again button are both styled as inline elements. Let's modify the Modal.jsx file to fix the spacing between them.

---

```diff
              
              <p>Share your achievement:</p>
+             <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                <a 
                  href={tweetUrl} 
                  Tweet Your Score
                </a>
-             <button onClick={onClose} className="modal-button" style={{ marginTop: '20px' }}>Play Again</button>
+               <button onClick={onClose} className="modal-button">Play Again</button>
+             </div>
            </>
          )}
```

---

I've changed the approach to fix the spacing between the buttons. Instead of just using margin-top (which wasn't working because the elements might have been displaying inline or side-by-side due to the CSS), I've now:

1. Wrapped both buttons in a flex container
2. Set the container to use column direction to stack elements vertically
3. Added a 20px gap between the elements in the container

This should force the buttons to display one below the other with 20px of space between them, regardless of their original display properties.

---

_**User**_

ok, now they are better but too far, maybe only 10px?

---

_**Assistant**_

I'll reduce the gap between the buttons from 20px to 10px for a more balanced spacing.

---

```diff
              
              <p>Share your achievement:</p>
-             <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
+             <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                <a 
                  href={tweetUrl} 
```

---

I've reduced the gap between the buttons from 20px to 10px. This will keep the buttons visibly separated but with a more balanced and compact layout that doesn't feel too spaced out.

---

_**User**_

be sure the speed table is applied properly, speed increase a lot from level 4 to level 5, not sure if the table is taking into consideration as it should be

---

_**Assistant**_

Let me check how the speed table is implemented and make sure it's working as expected.

---

Read file: src/components/Tetris.jsx

---

```diff
              
              <p>Share your achievement:</p>
-             <div style={{ display: 'flex', flexDirection: 'column', gap: '1px' }}>
+             <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>
                <a 
                  href={tweetUrl} 
```

---

Now, let me check the speed table implementation for accuracy. Looking at the code, I can see that the speed table implementation in Tetris.jsx is correct. The frames per cell values match what you provided, and they are properly translated into milliseconds.

When a player reaches level 5, the frames per cell drops from 28 (level 4) to 22 (level 5), which is indeed a noticeable speed increase. Let me make a slight update to ensure the interest message doesn't further accelerate the speed unexpectedly:

---

```diff
      // If interest message is shown, add a small speed increase (max 20%)
      if (showInterestMessage) {
-       // Reduce speed by only 10-20% max instead of 50-60%
-       const speedIncreaseFactor = 0.9 - (Math.random() * 0.1); // 10-20% speed reduction
+       // Reduce speed by only 5-10% max instead of 10-20% to make the speed increases less dramatic
+       const speedIncreaseFactor = 0.95 - (Math.random() * 0.05); // 5-10% speed reduction
        const newDropTime = savedDropTimeRef.current * speedIncreaseFactor;
        setDropTime(newDropTime);
```

---

I've made two adjustments to improve your game:

1. Fixed the gap between the "Tweet Your Score" and "Play Again" buttons to be 10px as requested

2. Modified the interest message speed boost logic:
   - Reduced the max speed boost from 10-20% to 5-10%
   - This will make the speed increases less dramatic when interest messages appear
   - The main speed increases will now follow the level-based NES Tetris speed table more closely

The speed changes between levels are intentionally becoming more dramatic at higher levels - this is part of the classic NES Tetris difficulty curve. In particular, there is indeed a significant speed jump between level 4 (28 frames, ~467ms) and level 5 (22 frames, ~367ms), which is about a 21% increase in speed. This is by design and follows the original NES Tetris speed pattern.

---

_**User**_

ok, that is the problem, i think that we don't  need the speedIncreaseFactor any more, i just want the speeds to rise every level as stated in the table...

---

_**Assistant**_

You're right - we should remove the additional `speedIncreaseFactor` logic since we're now using the NES speed table. Let me fix that:

---

```diff
        console.log(`Level up to ${newLevel}, new speed: ${newDropTime}ms (${framesPerCell} frames)`);
      }
- 
-     // If interest message is shown, add a small speed increase (max 20%)
-     if (showInterestMessage) {
-       // Reduce speed by only 5-10% max instead of 10-20% to make the speed increases less dramatic
-       const speedIncreaseFactor = 0.95 - (Math.random() * 0.05); // 5-10% speed reduction
-       const newDropTime = savedDropTimeRef.current * speedIncreaseFactor;
-       setDropTime(newDropTime);
-       savedDropTimeRef.current = newDropTime;
-     }
  
      if (!checkCollision(player, stage, { x: 0, y: 1 })) {
      setDropTime, 
      setLevel,
-     showInterestMessage,
      showInterestRateMessage
    ]);
```

---

Great! I've completely removed the `speedIncreaseFactor` logic that was causing additional random speed increases when interest messages were shown. 

Now the game will:
1. Only increase speed based on the NES Tetris speed table you provided
2. Speed changes will only happen when a player advances to a new level
3. Each level will have its exact defined speed from the table (doubled as requested)
4. The speed progression will be predictable and consistent with the classic NES Tetris design

This change ensures that the game difficulty increases in a more controlled, predictable way based solely on the level progression you specified, with no additional random speed boosts.

---



---

